<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Research Network</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0f;
            --bg-panel: #0d0d14;
            --bg-card: #12121a;
            --cyan: #00f0ff;
            --cyan-dim: #00f0ff40;
            --amber: #ffb800;
            --amber-dim: #ffb80040;
            --green: #00ff88;
            --red: #ff4057;
            --text: #e8e8f0;
            --text-dim: #6a6a80;
            --border: #1a1a28;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-deep);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        /* Scan line overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 240, 255, 0.01) 2px,
                rgba(0, 240, 255, 0.01) 4px
            );
            pointer-events: none;
            z-index: 1000;
        }

        .app {
            display: grid;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }

        /* Header */
        header {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            border: 2px solid var(--cyan);
            border-radius: 8px;
            display: grid;
            place-items: center;
            position: relative;
        }

        .logo-icon::before {
            content: '';
            width: 12px;
            height: 12px;
            background: var(--cyan);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .logo h1 span {
            color: var(--cyan);
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 12px var(--green);
        }

        .status-dot.disconnected {
            background: var(--red);
            box-shadow: 0 0 12px var(--red);
        }

        .status-dot.demo {
            background: var(--amber);
            box-shadow: 0 0 12px var(--amber);
        }

        /* Main layout */
        main {
            display: grid;
            grid-template-columns: 240px 1fr 320px;
            gap: 1px;
            background: var(--border);
        }

        /* Panels */
        .panel {
            background: var(--bg-panel);
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-dim);
        }

        /* Agents panel */
        .agents-list {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .agent-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            transition: all 0.3s ease;
        }

        .agent-card.active {
            border-color: var(--cyan);
            box-shadow: 0 0 20px var(--cyan-dim), inset 0 0 20px var(--cyan-dim);
        }

        .agent-card.delegating {
            border-color: var(--amber);
            box-shadow: 0 0 20px var(--amber-dim), inset 0 0 20px var(--amber-dim);
        }

        .agent-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .agent-status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
        }

        .agent-card.active .agent-status-indicator,
        .agent-card.delegating .agent-status-indicator {
            background: var(--green);
            box-shadow: 0 0 8px var(--green);
        }

        .agent-role {
            font-size: 11px;
            color: var(--text-dim);
            line-height: 1.4;
        }

        .agent-task {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--cyan);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .agent-card.active .agent-task,
        .agent-card.delegating .agent-task {
            opacity: 1;
        }

        /* Chat panel */
        .chat-panel {
            background: var(--bg-deep);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            max-width: 85%;
            animation: messageIn 0.3s ease-out;
        }

        @keyframes messageIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
        }

        .message.system {
            align-self: flex-start;
        }

        .message-content {
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--cyan-dim), transparent);
            border: 1px solid var(--cyan);
        }

        .message.system .message-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .message-sender {
            font-size: 11px;
            color: var(--text-dim);
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        .message.user .message-sender {
            text-align: right;
            color: var(--cyan);
        }

        /* Structured output */
        .structured-output {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 12px;
            overflow: hidden;
        }

        .output-header {
            background: var(--bg-panel);
            padding: 10px 14px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--amber);
            border-bottom: 1px solid var(--border);
        }

        .output-body {
            padding: 14px;
            font-size: 13px;
            line-height: 1.7;
        }

        .output-body h4 {
            color: var(--cyan);
            font-size: 12px;
            margin: 12px 0 6px;
            font-weight: 500;
        }

        .output-body h4:first-child {
            margin-top: 0;
        }

        .output-body ul {
            padding-left: 18px;
            color: var(--text-dim);
        }

        .output-body li {
            margin: 4px 0;
        }

        /* Chat input */
        .chat-input-area {
            padding: 16px;
            border-top: 1px solid var(--border);
            background: var(--bg-panel);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 18px;
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: var(--cyan);
        }

        .chat-input::placeholder {
            color: var(--text-dim);
        }

        .send-btn {
            background: var(--cyan);
            border: none;
            border-radius: 12px;
            padding: 0 24px;
            color: var(--bg-deep);
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-btn:hover {
            box-shadow: 0 0 20px var(--cyan-dim);
            transform: translateY(-1px);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Logs panel */
        .logs-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        .log-entry {
            padding: 10px 12px;
            border-left: 2px solid var(--border);
            margin-bottom: 8px;
            animation: logIn 0.4s ease-out;
            background: var(--bg-card);
            border-radius: 0 6px 6px 0;
        }

        @keyframes logIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-entry.event { border-left-color: var(--cyan); }
        .log-entry.delegate { border-left-color: var(--amber); }
        .log-entry.tool { border-left-color: var(--green); }
        .log-entry.result { border-left-color: #a855f7; }

        .log-time {
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .log-source {
            color: var(--cyan);
            margin-bottom: 4px;
        }

        .log-entry.delegate .log-source { color: var(--amber); }
        .log-entry.tool .log-source { color: var(--green); }
        .log-entry.result .log-source { color: #a855f7; }

        .log-message {
            color: var(--text);
            line-height: 1.4;
        }

        /* Demo banner */
        .demo-banner {
            background: linear-gradient(90deg, var(--amber-dim), transparent);
            border: 1px solid var(--amber);
            border-radius: 8px;
            padding: 12px 16px;
            margin: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-banner-icon {
            font-size: 16px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="logo">
                <div class="logo-icon"></div>
                <h1>Academic Research <span>Network</span></h1>
            </div>
            <div class="status">
                <div class="status-dot demo" id="statusDot"></div>
                <span id="statusText">Demo Mode</span>
            </div>
        </header>

        <main>
            <div class="panel agents-panel">
                <div class="panel-header">Agents</div>
                <div class="agents-list">
                    <div class="agent-card" id="academic-partner">
                        <div class="agent-name">
                            <div class="agent-status-indicator"></div>
                            academic-partner
                        </div>
                        <div class="agent-role">åè°ƒè€… - æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œåˆ†æä»»åŠ¡ï¼Œå§”æ´¾ç»™ä¸“ä¸š Agent</div>
                        <div class="agent-task" id="academic-partner-task">ç­‰å¾…ä»»åŠ¡...</div>
                    </div>
                    <div class="agent-card" id="literature-agent">
                        <div class="agent-name">
                            <div class="agent-status-indicator"></div>
                            literature-agent
                        </div>
                        <div class="agent-role">æ–‡çŒ®ä¸“å®¶ - æœç´¢ã€é˜…è¯»ã€åˆ†æå­¦æœ¯æ–‡çŒ®</div>
                        <div class="agent-task" id="literature-agent-task">ç­‰å¾…ä»»åŠ¡...</div>
                    </div>
                </div>
                <div class="demo-banner">
                    <span class="demo-banner-icon">âš¡</span>
                    <span>è¾“å…¥æ¶ˆæ¯å‘é€åˆ° Agent</span>
                </div>
            </div>

            <div class="panel chat-panel">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-area">
                    <div class="chat-input-wrapper">
                        <input type="text" class="chat-input" id="chatInput"
                               placeholder="è¾“å…¥æ¶ˆæ¯..."
                               value="è¯·å¸®æˆ‘æ·±åº¦é˜…è¯»ã€Šäººå·¥æ™ºèƒ½ç´ å…»ã€‹ç›¸å…³æ–‡çŒ®">
                        <button class="send-btn" id="sendBtn">å‘é€</button>
                    </div>
                </div>
            </div>

            <div class="panel logs-panel">
                <div class="panel-header">å®æ—¶æ—¥å¿—</div>
                <div class="logs-list" id="logsList"></div>
            </div>
        </main>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const logsList = document.getElementById('logsList');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        const API_BASE = 'http://localhost:8700/api';
        let clientId = 'demo-client-' + Date.now();
        let secret = null;
        let isConnected = false;
        let pollInterval = null;

        // æ³¨å†Œå®¢æˆ·ç«¯å¹¶è®¢é˜…æ‰€æœ‰äº‹ä»¶
        async function register() {
            try {
                const res = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agent_id: clientId, metadata: { type: 'demo-ui' } })
                });
                const data = await res.json();
                if (data.success) {
                    secret = data.secret;
                    isConnected = true;
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Connected';
                    addLog('system', `å·²è¿æ¥: ${clientId}`, 'event');

                    // è®¢é˜…æ‰€æœ‰äº‹ä»¶ä»¥çœ‹åˆ°æµå¼è¾“å‡º
                    await fetch(`${API_BASE}/send_event`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            event_id: 'sub-' + Date.now(),
                            event_name: 'system.subscribe_events',
                            source_id: clientId,
                            target_agent_id: 'system:system',
                            payload: { event_patterns: ['*'] },
                            secret: secret
                        })
                    });
                    addLog('system', 'å·²è®¢é˜…æ‰€æœ‰äº‹ä»¶æµ', 'event');

                    startPolling();
                    return true;
                }
            } catch (e) {
                console.error('Register failed:', e);
            }
            statusDot.className = 'status-dot disconnected';
            statusText.textContent = 'Disconnected';
            return false;
        }

        // è½®è¯¢æ¶ˆæ¯ (æ›´å¿«çš„é—´éš”ä»¥è·å–æµå¼æ•ˆæœ)
        function startPolling() {
            pollInterval = setInterval(async () => {
                if (!isConnected) return;
                try {
                    const res = await fetch(`${API_BASE}/poll?agent_id=${clientId}&secret=${secret}`);
                    const data = await res.json();
                    if (data.success && data.messages) {
                        for (const msg of data.messages) {
                            handleIncomingEvent(msg);
                        }
                    }
                } catch (e) { console.error('Poll error:', e); }
            }, 500);  // 500ms è½®è¯¢ä»¥è·å–æ›´æµç•…çš„æ›´æ–°
        }

        // å¤„ç†æ”¶åˆ°çš„äº‹ä»¶ - è¯¦ç»†å±•ç¤ºæ‰§è¡Œè¿‡ç¨‹
        function handleIncomingEvent(event) {
            const name = event.event_name || '';
            const payload = event.payload || {};
            const source = event.source_id || 'system';
            const target = event.destination_id || event.target_agent_id || '';

            // æ ¹æ®äº‹ä»¶ç±»å‹åˆ†ç±»æ˜¾ç¤º
            if (name.includes('delegate_task') || name.includes('task.created')) {
                // ä»»åŠ¡å§”æ´¾
                const taskDesc = payload.description || payload.task || JSON.stringify(payload).slice(0, 80);
                addLog(source, `ğŸ“¤ å§”æ´¾ä»»åŠ¡ â†’ ${target}: ${taskDesc}`, 'delegate');
                setAgentState('academic-partner', 'delegating', `å§”æ´¾ç»™ ${target}`);
                if (target.includes('literature')) {
                    setAgentState('literature-agent', 'active', 'æ¥æ”¶ä»»åŠ¡...');
                }
            } else if (name.includes('tool') || name.includes('function_call')) {
                // å·¥å…·è°ƒç”¨
                const toolName = payload.tool || payload.name || payload.function || 'unknown';
                const args = payload.arguments || payload.args || payload.input || {};
                addLog(source, `ğŸ”§ è°ƒç”¨å·¥å…·: ${toolName}(${JSON.stringify(args).slice(0, 60)})`, 'tool');
                setAgentState(source.includes('literature') ? 'literature-agent' : 'academic-partner', 'active', `æ‰§è¡Œ ${toolName}`);
            } else if (name.includes('tool_result') || name.includes('function_result')) {
                // å·¥å…·ç»“æœ
                const result = payload.result || payload.output || JSON.stringify(payload).slice(0, 100);
                addLog(source, `âœ… å·¥å…·è¿”å›: ${result}`, 'result');
            } else if (name.includes('llm') || name.includes('stream') || name.includes('chunk')) {
                // LLM æµå¼è¾“å‡º
                const content = payload.content || payload.text || payload.chunk || '';
                if (content) {
                    appendStreamContent(source, content);
                }
            } else if (name.includes('complete') || name.includes('done') || name.includes('finished')) {
                // ä»»åŠ¡å®Œæˆ
                addLog(source, `ğŸ‰ ä»»åŠ¡å®Œæˆ`, 'result');
                setAgentState('academic-partner', '', 'ç­‰å¾…ä»»åŠ¡...');
                setAgentState('literature-agent', '', 'ç­‰å¾…ä»»åŠ¡...');
            } else if (name.includes('reply') || name.includes('message') || name.includes('response')) {
                // æ¶ˆæ¯/å“åº” - content å¯èƒ½æ˜¯ {text: "..."} æˆ–ç›´æ¥æ˜¯å­—ç¬¦ä¸²
                let content = payload.content;
                if (content && typeof content === 'object') content = content.text || '';
                content = content || payload.message || payload.text || '';
                const sender = payload.sender_id || source;
                if (content && sender !== clientId) {
                    addMessage(content, 'system', sender);
                }
                addLog(sender, `ğŸ’¬ ${content.slice(0, 80)}`, 'event');
            } else if (name.includes('progress')) {
                // è¿›åº¦æ›´æ–°
                const progress = payload.progress || payload.status || payload.message || '';
                addLog(source, `â³ ${progress}`, 'event');
            } else {
                // å…¶ä»–äº‹ä»¶ä¹Ÿæ˜¾ç¤º
                addLog(source, `${name}: ${JSON.stringify(payload).slice(0, 80)}`, 'event');
            }

            // æ›´æ–° Agent çŠ¶æ€æŒ‡ç¤ºå™¨
            if (source.includes('academic-partner')) {
                setAgentState('academic-partner', 'active', name.split('.').pop());
            } else if (source.includes('literature')) {
                setAgentState('literature-agent', 'active', name.split('.').pop());
            }
        }

        // æµå¼å†…å®¹è¿½åŠ åˆ°æœ€åä¸€æ¡æ¶ˆæ¯
        let lastStreamMsg = null;
        function appendStreamContent(source, content) {
            if (!lastStreamMsg || lastStreamMsg.dataset.source !== source) {
                lastStreamMsg = document.createElement('div');
                lastStreamMsg.className = 'message system';
                lastStreamMsg.dataset.source = source;
                lastStreamMsg.innerHTML = `
                    <div class="message-sender">${source}</div>
                    <div class="message-content"></div>
                `;
                chatMessages.appendChild(lastStreamMsg);
            }
            const contentEl = lastStreamMsg.querySelector('.message-content');
            contentEl.textContent += content;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage(content) {
            if (!isConnected) {
                addLog('system', 'æœªè¿æ¥ï¼Œå°è¯•é‡è¿...', 'event');
                await register();
                if (!isConnected) return;
            }

            addMessage(content, 'user', 'You');
            setAgentState('academic-partner', 'active', 'å¤„ç†ä¸­...');

            const event = {
                event_id: clientId + '_' + Date.now() + '_' + Math.random().toString(36).slice(2, 10),
                event_name: 'thread.channel_message.post',
                source_id: clientId,
                target_agent_id: 'channel:general',
                payload: {
                    channel: 'general',
                    content: { text: content },
                    message_type: 'channel_message'
                },
                secret: secret
            };

            try {
                const res = await fetch(`${API_BASE}/send_event`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(event)
                });
                const data = await res.json();
                addLog(clientId, `å‘é€æ¶ˆæ¯ â†’ channel:general`, 'delegate');
                if (!data.success) {
                    addLog('system', `å‘é€å¤±è´¥: ${data.message}`, 'event');
                }
            } catch (e) {
                addLog('system', `å‘é€é”™è¯¯: ${e.message}`, 'event');
            }
        }

        // åˆå§‹åŒ–è¿æ¥
        register();

        function addMessage(content, type, sender = '') {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.innerHTML = `
                ${sender ? `<div class="message-sender">${sender}</div>` : ''}
                <div class="message-content">${content}</div>
            `;
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLog(source, message, type = 'event') {
            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            const log = document.createElement('div');
            log.className = `log-entry ${type}`;
            log.innerHTML = `
                <div class="log-time">${time}</div>
                <div class="log-source">${source}</div>
                <div class="log-message">${message}</div>
            `;
            logsList.appendChild(log);
            logsList.scrollTop = logsList.scrollHeight;
        }

        function setAgentState(agentId, state, task = '') {
            const card = document.getElementById(agentId);
            const taskEl = document.getElementById(`${agentId}-task`);
            card.className = `agent-card ${state}`;
            if (task) taskEl.textContent = task;
        }

        async function runDemo(userMessage) {
            sendBtn.disabled = true;

            // User message
            addMessage(userMessage, 'user', 'You');

            await delay(500);

            // Academic partner receives
            setAgentState('academic-partner', 'active', 'åˆ†æç”¨æˆ·è¯·æ±‚...');
            addLog('academic-partner', 'æ”¶åˆ°ç”¨æˆ·è¯·æ±‚: æ·±åº¦é˜…è¯»æ–‡çŒ®', 'event');

            await delay(1200);

            // Delegate to literature agent
            setAgentState('academic-partner', 'delegating', 'å§”æ´¾ä»»åŠ¡ç»™ literature-agent');
            addLog('academic-partner', 'ä»»åŠ¡ç±»å‹: æ–‡çŒ®æ·±åº¦é˜…è¯» â†’ å§”æ´¾ç»™ literature-agent', 'delegate');

            await delay(800);

            // Literature agent starts
            setAgentState('literature-agent', 'active', 'æ‰§è¡Œæ–‡çŒ®æœç´¢...');
            setAgentState('academic-partner', '', 'ç­‰å¾…å­ä»»åŠ¡å®Œæˆ');
            addLog('literature-agent', 'æ”¶åˆ°ä»»åŠ¡å§”æ´¾ï¼Œå¼€å§‹æ‰§è¡Œ', 'event');

            await delay(600);

            // Tool call: search
            addLog('literature-agent', 'è°ƒç”¨å·¥å…·: search_literature("äººå·¥æ™ºèƒ½ç´ å…»")', 'tool');

            await delay(1500);

            addLog('literature-agent', 'æœç´¢å®Œæˆ: æ‰¾åˆ° 12 ç¯‡ç›¸å…³æ–‡çŒ®', 'result');
            setAgentState('literature-agent', 'active', 'è¯»å–æ–‡çŒ®å†…å®¹...');

            await delay(800);

            // Tool call: read
            addLog('literature-agent', 'è°ƒç”¨å·¥å…·: read_literature("ä½•è°“äººå·¥æ™ºèƒ½ç´ å…»")', 'tool');

            await delay(2000);

            addLog('literature-agent', 'æ–‡çŒ®è¯»å–å®Œæˆ: 28,812 å­—ç¬¦', 'result');

            await delay(600);

            // Generate notes
            setAgentState('literature-agent', 'active', 'ç”Ÿæˆç»“æ„åŒ–ç¬”è®°...');
            addLog('literature-agent', 'æ­£åœ¨ç”Ÿæˆæ·±åº¦é˜…è¯»ç¬”è®°...', 'event');

            await delay(1500);

            // Task complete
            setAgentState('literature-agent', '', 'ä»»åŠ¡å®Œæˆ');
            addLog('literature-agent', 'ä»»åŠ¡å®Œæˆï¼Œè¿”å›ç»“æœç»™ academic-partner', 'result');

            await delay(500);

            setAgentState('academic-partner', 'active', 'æ•´åˆç»“æœ...');
            addLog('academic-partner', 'æ”¶åˆ° literature-agent ç»“æœï¼Œæ•´åˆè¾“å‡º', 'event');

            await delay(800);

            // Final response
            const response = `
                å·²å®Œæˆã€Šäººå·¥æ™ºèƒ½ç´ å…»ã€‹ç›¸å…³æ–‡çŒ®çš„æ·±åº¦é˜…è¯»ã€‚
                <div class="structured-output">
                    <div class="output-header">ğŸ“š æ·±åº¦é˜…è¯»ç¬”è®° - ä½•è°“äººå·¥æ™ºèƒ½ç´ å…»</div>
                    <div class="output-body">
                        <h4>æ ¸å¿ƒæ¦‚å¿µ</h4>
                        <ul>
                            <li>AIç´ å…»æ˜¯æ•°å­—ç´ å…»åœ¨äººå·¥æ™ºèƒ½æ—¶ä»£çš„å»¶ä¼¸ä¸æ·±åŒ–</li>
                            <li>åŒ…å«è®¤çŸ¥ã€æŠ€èƒ½ã€æ€åº¦ä¸‰ä¸ªç»´åº¦</li>
                        </ul>
                        <h4>ç†è®ºè´¡çŒ®</h4>
                        <ul>
                            <li>æå‡º AI ç´ å…»çš„ä¸‰å±‚ç»“æ„æ¨¡å‹</li>
                            <li>åŒºåˆ†"ä½¿ç”¨AI"ä¸"ç†è§£AI"çš„èƒ½åŠ›è¾¹ç•Œ</li>
                        </ul>
                        <h4>å¯¹æœ¬ç ”ç©¶çš„å¯ç¤º</h4>
                        <ul>
                            <li>å¯ä½œä¸º"AIç´ å…»"æ“ä½œåŒ–å®šä¹‰çš„ç†è®ºåŸºç¡€</li>
                            <li>æ”¯æŒèµ„æºä¾èµ–è§†è§’ä¸‹çš„èƒ½åŠ›å·®å¼‚åˆ†æ</li>
                        </ul>
                    </div>
                </div>
            `;

            addMessage(response, 'system', 'academic-partner');
            setAgentState('academic-partner', '', 'ç­‰å¾…ä»»åŠ¡...');
            addLog('academic-partner', 'å“åº”å·²å‘é€ç»™ç”¨æˆ·', 'event');

            sendBtn.disabled = false;
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        sendBtn.addEventListener('click', () => {
            const msg = chatInput.value.trim();
            if (!msg) return;
            chatInput.value = '';
            sendMessage(msg);
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendBtn.click();
        });
    </script>
</body>
</html>
