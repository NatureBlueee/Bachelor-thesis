---
description: 同步系统状态，确保各模块信息一致
---

# /sync 工作流

## 用途

在关键操作后调用，自动同步相关模块的元信息，解决"AI部分遵循指令"和"信息孤岛"问题。

## 设计原则

> **重要**：/sync 不是"执行器"，而是"评估器+执行器"。
> 即使用户发起了此工作流，也要先判断"值不值得同步"。
> "无需同步"是完全合理的结论。

## 触发时机

用户可能在以下情况后调用：

1. PR 状态变更（创建/关闭/合并）
2. Consensus 问答结束
3. 新增/删除文献
4. 重要讨论结束
5. 章节完成
6. 或者只是不确定要不要同步

## 执行步骤

### 0. 评估是否需要同步（必做）

先回答这个问题：**自上次同步以来，有什么变化吗？**

检查：
- PR 有新建/状态变更吗？
- Consensus 有新的问答吗？
- 文献有增删吗？
- MEMORY.md 有更新吗？
- _STATE.md 的内容还准确吗？

**如果都没有变化**，输出：

```markdown
## 同步评估结果

**结论**：无需同步

**原因**：自上次同步以来没有检测到变化。

**上次同步时间**：{{从 _STATE.md 读取}}
```

然后**停止**，不执行后续步骤。

**如果有变化**，继续执行后续步骤。

### 1. 读取当前状态

首先读取以下文件获取最新状态：
- `PR/_INDEX.md` - 所有 PR 列表和状态
- `Consensus/_CONTEXT.md` - 研究进度
- `Reference/_INDEX.md` - 文献列表
- `MEMORY.md` - 记忆笔记

### 2. 更新 `_STATE.md`

在根目录更新或创建 `_STATE.md`，按以下模板：

```markdown
# 系统状态快照

> **最后同步**：{{当前日期时间}}
> **同步触发**：{{触发原因，如"PR-0005 合并"}}

## 当前焦点

- **阶段**：{{如"Chapter 2 完成，准备 Methodology"}}
- **活跃工作**：{{如"PR-0005 访谈提纲细化"}}

## 活跃 PR

| ID | 标题 | 状态 | 创建日期 | 更新日期 |
|----|------|------|---------|---------|
{{从 PR/_INDEX.md 提取 planning/doing 状态的 PR}}

## 近期完成

- {{最近3个已合并的PR或关闭的CON}}

## 待办清单

- [ ] {{从 MEMORY.md 或讨论中提取的待办}}

## 文献状态

- 总数：{{Reference/_INDEX.md 中的文献数}}
- 本周新增：{{如有}}
- 待读：{{如有标记}}

## 需要注意

{{任何需要跨模块关注的事项}}
```

### 3. 联动更新检查

检查以下文件是否需要同步更新：

| 文件 | 检查项 | 操作 |
|------|--------|------|
| `MEMORY.md` | 标题日期是否最新 | 更新为当前日期 |
| `Consensus/_CONTEXT.md` | 阶段描述是否准确 | 必要时更新 |
| `PR/_INDEX.md` | 状态是否最新 | 必要时更新 |

### 4. 输出同步报告

完成后输出简短报告：

```markdown
## 同步完成

- **时间**：{{日期时间}}
- **更新了**：
  - ✅ _STATE.md
  - ✅ MEMORY.md 标题日期
  - ⏭️ _CONTEXT.md（无需更新）
- **发现的问题**：
  - {{如有不一致或缺失}}
```

---

## 注意事项

1. **不是每次对话都要调用**：只在"关键操作"后调用
2. **可以批量同步**：一次讨论涉及多个变更，最后统一同步
3. **发现问题要报告**：如发现不一致，明确指出而非静默跳过
4. **保持简洁**：_STATE.md 不超过一屏，只保留最重要信息

### 🔴 重要规则（2025-12-20 补充）

**_STATE.md 追加而非覆盖**：
- 更新"当前焦点"等动态部分
- 保留"同步历史"小节（最近3条）
- 绝对不要删除有价值的历史记录

**同步历史格式**：
```markdown
## 同步历史（最近3条）

| 时间 | 触发 | 主要变更 |
|------|------|----------|
| 2025-12-20 14:37 | PR-0006合并 | 阶段→Methodology细化 |
```

---

## Checklist（同步前必须确认）

> [!WARNING]
> 以下每一项都必须明确确认

- [ ] ☑️ 读取了PR/_INDEX.md
- [ ] ☑️ 读取了MEMORY.md最新内容
- [ ] ☑️ _STATE.md是**追加更新**而非覆盖
- [ ] ☑️ 同步历史已记录本次变更
- [ ] ☑️ 输出了同步报告
